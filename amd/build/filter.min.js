define("local_amos/filter",["exports","core/utils","core/str","core/pubsub","./filter_events","./translator_events"],(function(_exports,_utils,_str,PubSub,_filter_events,_translator_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,PubSub=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * JS module for the AMOS translator filter.
   *
   * @module      local_amos/filter
   * @copyright   2020 David Mudr√°k <david@moodle.com>
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(PubSub),_filter_events=_interopRequireDefault(_filter_events),_translator_events=_interopRequireDefault(_translator_events);let globalComponentsSelectorRowsCache=new Map,globalLanguageSelectorOptionsCache=[];_exports.init=()=>{populateDOMElementCaches(),registerEventListeners(),updateCounterOfSelectedComponents(),updateCounterOfSelectedLanguages(),showUsedAdvancedOptions(),scrollToFirstSelectedComponent()};const populateDOMElementCaches=()=>{document.getElementById("amosfilter_fcmp_items_table").querySelectorAll(":scope tr").forEach(((row,index)=>{let rowLabel=row.querySelector('label[for^="amosfilter_fcmp_f_"]'),mapKey="HEADING_"+index;rowLabel&&(mapKey=rowLabel.innerText.toString().toLowerCase()),globalComponentsSelectorRowsCache.set(mapKey,row)})),globalLanguageSelectorOptionsCache=document.getElementById("amosfilter_flng").querySelectorAll(":scope option")},registerEventListeners=()=>{let root=document.getElementById("amosfilter"),fcmp=document.getElementById("amosfilter_fcmp"),componentSearch=document.getElementById("amosfilter_fcmp_search"),languageSearch=document.getElementById("amosfilter_flng_search"),fver=document.getElementById("amosfilter_fver"),flast=document.getElementById("amosfilter_flast"),ftxn=document.getElementById("amosfilter_ftxn"),ftxe=document.getElementById("amosfilter_ftxe");root.addEventListener("click",(e=>{if(!e.target.hasAttribute("data-action"))return;let action=e.target.getAttribute("data-action"),region=e.target.closest("[data-region]").getAttribute("data-region");"amosfilter_fcmp"==region&&handleComponentSelectorAction(e,fcmp,action),"amosfilter_buttons"==region&&"togglemoreoptions"==action&&toggleMoreOptions(e,root),"amosfilter_buttons"==region&&"submit"==action&&(e.preventDefault(),e.target.blur(),document.getElementById("amosfilter_fpg").value=1,submitFilter())})),root.addEventListener("change",(e=>{e.target.id.startsWith("amosfilter_fcmp_")&&updateCounterOfSelectedComponents(),"amosfilter_flng"==e.target.id&&updateCounterOfSelectedLanguages(),"amosfilter_flast"==e.target.id&&(flast.checked?fver.setAttribute("disabled","disabled"):fver.removeAttribute("disabled")),"amosfilter_ftxn"!=e.target.id||ftxn.checked||ftxe.checked?"amosfilter_ftxe"!=e.target.id||ftxn.checked||ftxe.checked||(ftxn.checked=!0):ftxe.checked=!0})),PubSub.subscribe(_translator_events.default.pagechange,(page=>{document.getElementById("amosfilter_fpg").value=page,submitFilter()})),[componentSearch,languageSearch].forEach((inputField=>{inputField.addEventListener("keypress",(e=>{13==e.keyCode&&(e.preventDefault(),e.stopPropagation())}))})),componentSearch.addEventListener("input",(0,_utils.debounce)((()=>{handleComponentSearch(componentSearch)}),200)),languageSearch.addEventListener("input",(0,_utils.debounce)((()=>{handleLanguageSearch(languageSearch)}),200))},handleComponentSelectorAction=(e,fcmp,action)=>{let selectorComponentItem=':scope [data-region="amosfilter_fcmp_item"]:not(.hidden) input[name="fcmp[]"]';if(document.getElementById("amosfilter_fapp").checked=!1,document.getElementById("amosfilter_fworkplace").checked=!1,"selectstandard"==action&&(e.preventDefault(),fcmp.querySelectorAll("".concat(selectorComponentItem)).forEach((item=>{var type=item.getAttribute("data-component-type");item.checked="core"==type||"standard"==type}))),"selectworkplace"==action||"selectapp"==action){e.preventDefault();let selectedcomponent="";switch(action){case"selectworkplace":selectedcomponent="workplace";break;case"selectapp":selectedcomponent="app"}fcmp.querySelectorAll("".concat(selectorComponentItem)).forEach((item=>{item.checked=item.hasAttribute("data-component-"+selectedcomponent)})),document.getElementById("amosfilter_f"+selectedcomponent).checked=!0,showUsedAdvancedOptions()}"selectall"==action&&(e.preventDefault(),fcmp.querySelectorAll("".concat(selectorComponentItem)).forEach((item=>{item.checked=!0}))),"selectnone"==action&&(e.preventDefault(),fcmp.querySelectorAll("".concat(selectorComponentItem)).forEach((item=>{item.checked=!1}))),updateCounterOfSelectedComponents()},handleComponentSearch=inputField=>{let needle=inputField.value.toString().replace(/^ +| +$/,"").toLowerCase(),shadowTableBody=document.createElement("tbody");globalComponentsSelectorRowsCache.forEach(((row,key)=>{key.startsWith("HEADING")?shadowTableBody.appendChild(row):""!=needle&&-1===key.indexOf(needle)||shadowTableBody.appendChild(row)}));let fcmpItemTable=document.getElementById("amosfilter_fcmp_items_table");fcmpItemTable.innerHTML="",fcmpItemTable.appendChild(shadowTableBody)},updateCounterOfSelectedComponents=()=>{let fcmp=document.getElementById("amosfilter_fcmp"),counter=document.getElementById("amosfilter_fcmp_counter"),invalidfeedback=document.getElementById("amosfilter_fcmp_invalid_feedback"),count=fcmp.querySelectorAll(':scope input[name="fcmp[]"]:checked').length;0==count?(counter.classList.add("badge-danger"),fcmp.classList.add("is-invalid"),invalidfeedback.classList.remove("hidden")):(counter.classList.remove("badge-danger"),fcmp.classList.remove("is-invalid"),invalidfeedback.classList.add("hidden")),counter.textContent=count},handleLanguageSearch=inputField=>{let needle=inputField.value.toString().replace(/^ +| +$/,"").toLowerCase();globalLanguageSelectorOptionsCache.forEach((item=>{""==needle||-1!==item.text.toString().toLowerCase().indexOf(needle)?(item.classList.remove("hidden"),item.removeAttribute("disabled")):(item.classList.add("hidden"),item.setAttribute("disabled","disabled"))}))},updateCounterOfSelectedLanguages=()=>{let flng=document.getElementById("amosfilter_flng"),counter=document.getElementById("amosfilter_flng_counter"),invalidfeedback=document.getElementById("amosfilter_flng_invalid_feedback"),count=flng.querySelectorAll(":scope option:checked").length;0==count?(counter.classList.add("badge-danger"),flng.classList.add("is-invalid"),invalidfeedback.classList.remove("hidden")):(counter.classList.remove("badge-danger"),flng.classList.remove("is-invalid"),invalidfeedback.classList.add("hidden")),counter.textContent=count},toggleMoreOptions=async(e,root)=>{e.preventDefault(),"0"==root.getAttribute("data-level-showadvanced")?(root.setAttribute("data-level-showadvanced",1),e.target.innerText=await(0,_str.get_string)("lessfilteringoptions","local_amos")):(root.setAttribute("data-level-showadvanced",0),e.target.innerText=await(0,_str.get_string)("morefilteringoptions","local_amos"),showUsedAdvancedOptions())},showUsedAdvancedOptions=()=>{let root=document.getElementById("amosfilter");root.querySelectorAll(':scope [data-level="advanced"][data-level-control]').forEach((item=>{let control=document.getElementById(item.getAttribute("data-level-control")),forceshow=!1;if("input"==control.tagName.toLowerCase()&&"checkbox"==control.getAttribute("type")&&control.checked&&(forceshow=!0),"input"==control.tagName.toLowerCase()&&"text"==control.getAttribute("type")&&""!==control.value&&(forceshow=!0),"select"==control.tagName.toLowerCase()&&control.hasAttribute("data-default")&&!control.hasAttribute("disabled")){let selected=control.querySelectorAll(":scope option:checked");1!=selected.length?forceshow=!0:selected.forEach((option=>{option.value!==control.getAttribute("data-default")&&(forceshow=!0)}))}forceshow?item.setAttribute("data-level-forceshow",1):item.removeAttribute("data-level-forceshow")})),root.querySelectorAll(':scope [data-level="advanced"][data-level-control]').forEach((item=>{let control=document.getElementById(item.getAttribute("data-level-control"));"fieldset"==control.tagName.toLowerCase()&&(control.querySelector("[data-level-forceshow]")?item.setAttribute("data-level-forceshow",1):item.removeAttribute("data-level-forceshow"))}))},scrollToFirstSelectedComponent=()=>{let comp=document.getElementById("amosfilter_fcmp").querySelector('input[id^="amosfilter_fcmp_f_"]:checked');comp&&comp.scrollIntoView(!1)},submitFilter=()=>{let root=document.getElementById("amosfilter"),flng=document.getElementById("amosfilter_flng"),loadingIndicator=document.getElementById("amosfilter_loading_indicator"),languageSearch=document.getElementById("amosfilter_flng_search");loadingIndicator.classList.remove("hidden"),flng.querySelectorAll(":scope option").forEach((item=>{item.removeAttribute("disabled")}));let form=root.querySelector("form"),formdata=new FormData(form);handleLanguageSearch(languageSearch),formdata.delete("sesskey"),PubSub.publish(_filter_events.default.submit,new URLSearchParams(formdata).toString())}}));

//# sourceMappingURL=filter.min.js.map